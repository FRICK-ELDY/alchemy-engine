# AlchemyEngine — 具体的なマイナス点

> 評価日: 2026-03-01
> 評価対象: プロジェクト全体（Elixir + Rust 全レイヤー）
>
> 採点基準: -1（軽微）/ -2（拡張を阻害）/ -3（バグ・クラッシュを引き起こしうる）/ -4（価値命題を損なう）/ -5（根幹を揺るがす致命的欠陥）

---

## Elixir の真価

### ネットワーク・並行性の未実証

**`game_network.ex` が完全な空スタブ** -5
`apps/game_network/lib/game_network.ex` に実装が一切ない。Elixir を選んだ最大の根拠である「OTP による耐障害性」「軽量プロセスによる大規模並行性」「分散ノード間通信」「Phoenix Channels によるリアルタイム通信」がコードとして一切証明されていない。「なぜ Lua スクリプティングや Python ではなく Elixir なのか」という問いに、現在のコードは答えられない。プロジェクトの根幹を揺るがす致命的な欠陥。

**複数ルームが一度も起動されていない** -4
`RoomSupervisor`（DynamicSupervisor）と `RoomRegistry` は存在するが、`GameServer.Application` で起動するのは `:main` の 1 ルームのみ。OTP の並行性・プロセス隔離が実際に機能することが実証されていない。設計はあるが動作実績がなく、プロジェクトの価値命題を損なっている。

### `GameEvents` の肥大化

**`GameEvents` GenServer が 697 行で複数の責務を持つ** -3
ゲームループティック・シーンディスパッチ・NIF 呼び出し・イベント処理・セーブ/ロード調整・レンダー状態管理が 1 つの GenServer に混在している。単一責任の原則に違反しており、テスト・拡張・デバッグが困難。`GameEvents` のテストが 0 件なのはこの複雑さが直接の原因。

### NIF の安全性

**NIF コード内に `unwrap()` / `expect()` が残存している** -3
NIF 内でパニックが発生すると BEAM VM 全体がクラッシュする。OTP の障害隔離保証が完全に無効化される。`game_nif/src/nif/` 以下に複数の `unwrap()` が残っており、`improvement-plan.md` でも認識済みだが未解消。バグ・クラッシュを引き起こしうる設計上の欠陥。

**NIF パニック後のゲームループ再起動ロジックが存在しない** -2
`GameEvents` がクラッシュして Supervisor が再起動しても、前のプロセスが保持していた Rust `GameWorld` リソースは失われる。チェックポイント/リストア機構がなく、クラッシュ後に既知の良い状態から再開できない。将来の拡張を阻害する。

### Elixir 側テスト

**`GameEngine.GameEvents`（697 行）のテストがゼロ** -4
プロジェクトで最も重要なモジュールがテストされていない。フレームイベント処理・シーン遷移・NIF 呼び出し順序・セーブ/ロード連携のいずれも自動検証されていない。品質保証の観点でプロジェクトの価値命題を損なっている。

**`SceneManager` / `EventBus` / 全シーンモジュールのテストがゼロ** -3
シーンスタックの push/pop/replace ロジック、EventBus のサブスクライバー配信、各シーンの `update/2` 純粋関数部分がすべて未テスト。`game_content` の純粋関数テストは存在するが、エンジンコアのテストカバレッジは事実上ゼロ。リグレッションを引き起こしうる設計上の欠陥。

---

## Rust の真価

### プラットフォーム対応

**SIMD パスが x86_64 専用で ARM NEON 実装がない** -2
`update_chase_ai_simd` は SSE2 専用。Apple Silicon（M1/M2/M3）・ARM サーバー・モバイル環境では rayon フォールバックになる。Apple Silicon が主流になりつつある現在、将来の拡張を阻害する技術的負債になりうる。

**WASM / `#[no_std]` ターゲットへの準備がゼロ** -2
`game_physics` の依存が最小限なので技術的には可能だが、`cfg` フラグも feature ゲートも存在しない。ブラウザ上でのサーバーサイドシミュレーションや WASM 対応の道が閉ざされており、将来の拡張を阻害する。

### スプライト・アセット

**スプライトアトラスの UV 座標がマジックナンバーで散在している** -2
`renderer/mod.rs` と `renderer/ui.rs` にピクセルオフセットがハードコードされている。新しいスプライトを追加するには UV 計算を手動で行い複数箇所を編集する必要があり、将来の拡張を阻害する。

**Ghost・Skeleton の UV が `TODO` プレースホルダー** -2
`// TODO: assign correct UV` コメントが残存しており、これらの敵が現在のビルドで正しいスプライトで表示されていない。未完成の視覚表現がそのまま残っており、将来の拡張を阻害している。

### 描画・レンダリング

**ヘッドレス/オフスクリーンレンダリングモードが存在しない** -3
ウィンドウを開かずにエンジンを実行する方法がない。自動スクリーンショットテスト・CI でのレンダリング検証・スペクテーターモードのサーバーサイドレンダリングがすべて不可能。CI テストを阻害するため、バグ・クラッシュを引き起こしうる設計上の欠陥。

**レンダーグラフや明示的なパス依存宣言がない** -2
スプライトパス → egui パスの順序が `renderer/mod.rs` にハードコードされている。新しいパス（シャドウマップ・ブルームポストプロセス等）を追加するにはレンダラー内部を直接編集する必要があり、将来の拡張を阻害する。

**画面外エンティティのフラスタムカリングがない** -2
`render_data` に含まれる全エンティティが可視かどうかに関わらず GPU に送信される。10,000 体規模では画面外の敵も含めて頂点処理が走り、将来の拡張（エンティティ数増加）を阻害する。

**egui HUD レイアウトロジックがレンダリングバックエンドと結合している** -2
HP バー・EXP バー・武器スロットのレイアウト計算が `renderer/ui.rs` に直接書かれている。GPU なしで HUD レイアウトをテストする方法がなく、将来の拡張を阻害する。

### オーディオ

**空間オーディオ（距離減衰）が未実装** -1
すべての SE が距離に関わらずフルボリュームで再生される。10,000 体の敵が存在するゲームで位置情報のないオーディオは、ゲームプレイフィードバックとして不十分。軽微な問題。

**ボイスリミット・優先度システムが存在しない** -2
大量の敵が同時に死亡すると、全 `EntityRemoved` イベントが `PlaySe` を発火する。ボイス数の上限も優先度キューも重複排除もなく、オーディオクリッピングやデバイス過負荷が発生しうる。将来の拡張を阻害する。

**BGM ファイルがリポジトリに存在しない** -2
`item_pickup.wav` と `level_up.wav` の 2 ファイルのみ確認済み。BGM ファイルが存在せず、フレッシュなチェックアウトでは事実上無音のゲームになる。オーディオシステムは実装されているが機能していない。将来の拡張を阻害する。

---

## Elixir × Rust 連携の真価

### NIF の安定性

**NIF バージョニング・ABI 互換性チェックが存在しない** -2
Rust NIF の ABI が変わった場合（関数追加・引数型変更）、Elixir 側の `NifBridge` を同期して更新しなければならないが、ロード時の互換性チェックがない。不一致時は難解なエラーメッセージしか出ず、将来の拡張を阻害する。

### パフォーマンス

**`set_hud_state` が毎フレーム write lock を取得する** -1
HUD データ（レベル・EXP・武器選択肢）はレベルアップ時にしか変わらないが、毎フレーム write lock を取得して注入している。変更がない場合でも write lock を取るのは不必要なロック競合を生む。軽微な問題。

**Rust 60Hz ループ → Elixir メールボックスへのバックプレッシャーがない** -3
Rust ループが 60Hz で無条件に `{:frame_events, events}` を Elixir プロセスに送信し続ける。Elixir が GC ポーズや重いシーン遷移で遅れた場合、メールボックスが無制限に増大する。フロー制御・ドロップポリシー・メールボックス深さの監視がいずれも存在しない。OOM クラッシュを引き起こしうる設計上の欠陥。

---

## 物理層

### プラットフォーム依存

**ARM NEON の SIMD 実装がない** -2
x86_64 以外では rayon フォールバックになるが、ARM NEON でも 4 体並列 SIMD は実現可能。Apple Silicon が主流になりつつある現在、将来の拡張を阻害する技術的負債。

### 衝突検出

**広域フェーズに BVH / AABB ツリーがない（空間ハッシュのみ）** -2
空間ハッシュは均一分布では優秀だが、ボス戦のような密集シナリオでは同一セルへの集中が発生し性能が劣化する。将来のエンティティ数増加で問題が顕在化しうる。

### 設計の明示性

**物理ステップの実行順序が暗黙的でドキュメントがない** -2
`physics_step.rs` の呼び出し順序（プレイヤー移動 → 障害物押し出し → Chase AI → 分離 → 衝突 → 武器 → パーティクル → アイテム → 弾丸 → ボス）がなぜこの順序なのかが文書化されていない。順序を変更した場合の影響が不明で、将来の拡張でバグを埋め込みやすい。

---

## ネットワーク層

**ネットワーク層が 0% 実装** -5
`game_network.ex` は空モジュール。Phoenix Channels / WebSocket トランスポート・UDP ゲーム状態同期・ルーム発見/マッチメイキング・ラグ補償・ロールバック netcode のいずれも存在しない。Elixir を選択した根拠の全てがこの層に依存しているにもかかわらず、完全に未実装。プロジェクトの根幹を揺るがす致命的な欠陥。

---

## ユーザー層

### 設定・カスタマイズ

**ゲーム内設定 UI が存在しない** -2
音量調整・キーリマッピング・解像度選択・グラフィック品質オプションがない。設定変更には `config.exs` の編集と再コンパイルが必要。将来の拡張（エンドユーザーへの配布）を阻害する。

### セーブデータ

**セーブ形式が Erlang バイナリ term（非ポータブル）** -2
`:erlang.term_to_binary` は BEAM VM 専用フォーマット。外部ツールでの検査・マイグレーション・デバッグが不可能。セーブデータのバージョン管理スキームも存在しない。将来の拡張を阻害する。

### リプレイ

**決定論的 LCG 乱数があるにもかかわらずリプレイシステムが未実装** -1
リプレイ実装の正しい基盤（決定論的乱数）が揃っているのに、リプレイ録画・再生が存在しない。基盤の価値が活かされていない。軽微な問題。

---

## プロジェクト全体設計

### CI/CD

**CI/CD パイプラインが存在しない** -4
`.github/workflows/` ディレクトリが存在しない。`mix test` / `cargo test` / `mix credo` / `cargo clippy` のいずれも自動実行されない。プルリクエストでのリグレッション検出が不可能で、品質保証の仕組みがゼロ。充実したドキュメントと自己認識的な弱点管理を持つプロジェクトとして、CI がないのはプロジェクトの価値命題を損なう大きな矛盾。

### ドキュメントの問題

**`visual-editor-architecture.md` が存在しないシステムを詳細に記述している** -1
ノードグラフエディタ・ライブプレビュー・アセットブラウザの詳細設計が書かれているが、対応するコードが一切ない。投機的なアーキテクチャドキュメントを `docs/` のメインツリーに置くことで、プロジェクトの現在の能力について誤解を招く。軽微な問題。

**`docs/improvement-plan.md` が完了済みタスクと進行中タスクを混在させている** -1
I-G〜I-O の完了済み項目がストライクスルーで残存しており、現在アクティブなタスクが何かを判断しにくい。改善計画書としての実用性が低下している。軽微な問題。

### ベンチマーク

**Elixir → Rust フルラウンドトリップのエンドツーエンドベンチマークがない** -2
`game_physics` には Criterion ベンチマークが存在するが、実際の1フレーム（Elixir inject → Rust physics_step → Rust drain_frame_events → Elixir handle_info）のレイテンシを測定するベンチマークがない。NIF 境界のオーバーヘッドが現実の負荷下で不明であり、将来の拡張を阻害する。
