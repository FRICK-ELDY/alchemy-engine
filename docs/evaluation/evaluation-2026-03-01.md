# AlchemyEngine — プロジェクト総合評価レポート

**評価日**: 2026-03-01
**評価者**: Cursor AI Agent（claude-4.6-sonnet-high）
**対象**: コードベース全体（Elixir umbrella アプリ群 + Rust ネイティブクレート群 + ドキュメント）

> 採点基準: +1（正しい）/ +2（良い判断）/ +3（平均を上回る）/ +4（プロダクション水準）/ +5（個人プロジェクトで見たことがない）
> 　　　　　-1（軽微）/ -2（拡張を阻害）/ -3（バグ・クラッシュを引き起こしうる）/ -4（価値命題を損なう）/ -5（根幹を揺るがす致命的欠陥）

---

## エグゼクティブサマリー

AlchemyEngine は Elixir を Single Source of Truth（SSoT）として、Rust で高性能な物理演算・描画・オーディオを処理するハイブリッドゲームエンジンである。Rust 層の技術水準は本物のプロダクション品質に達しており、Elixir の OTP 設計も骨格として正しい。しかし、プロジェクトの核心的な価値命題——「なぜ Elixir か」——は現在のコードベースで証明されていない。ネットワーク層が完全に未実装であり、複数ルームが一度も起動されていない現状では、Elixir を選んだ根拠（OTP 並行性・分散・Phoenix Channels）がコードとして存在しない。

---

## 観点別採点

---

### 1. Elixir の真価

| 項目 | 点数 |
|:---|:---:|
| `:one_for_one` Supervisor ツリーの正しい構成 | +2 |
| DynamicSupervisor + Registry による複数ルーム先行設計 | +3 |
| `StressMonitor` が独立プロセスとして存在する | +2 |
| 5 つの独立 GenServer による責務分離 | +3 |
| `ContentBehaviour` によるコンテンツ完全交換（2コンテンツ実証済み） | +5 |
| `Component` ビヘイビアのオプショナルコールバック設計 | +2 |
| `SceneBehaviour` 遷移戻り値の型安全設計 | +2 |
| Elixir as SSoT フェーズ1〜5の完遂 | +4 |
| ボス AI ロジックが Elixir 側に存在（SSoT 最難関の適用） | +4 |
| `:telemetry` による観測性 | +2 |
| `game_network.ex` が完全な空スタブ | **-5** |
| 複数ルームが一度も起動されていない | **-4** |
| `GameEvents` が 697 行・複数責務 | **-3** |
| NIF 内 `unwrap()` / `expect()` が BEAM VM をクラッシュさせうる | **-3** |
| クラッシュ後のゲームループ再起動ロジックがない | **-2** |
| `GameEvents`（697行）のテストがゼロ | **-4** |
| `SceneManager` / `EventBus` / 全シーンのテストがゼロ | **-3** |

**小計: +29 / -24 = +5点**

> Elixir を選んだ最大の根拠が未証明。OTP の骨格は正しいが、その上に乗るべき並行性・分散・ネットワークが存在しない。

---

### 2. Rust の真価

| 項目 | 点数 |
|:---|:---:|
| 全エンティティ種別の完全 SoA ECS 設計 | +4 |
| `free_list` による O(1) スポーン/キル | +3 |
| SSE2 SIMD 4体並列 Chase AI | +4 |
| `alive_mask` による死亡敵の速度フィールド保護 | +4 |
| SIMD / rayon / スカラーの 3 段階適応戦略 | +3 |
| SIMD/スカラー一致テストの存在 | +4 |
| `FxHashMap` 空間ハッシュによる O(n) 衝突検出 | +4 |
| LCG 決定論的乱数（リプレイ/同期の基盤） | +5 |
| `ResourceArc` による Elixir GC 連動ライフタイム管理 | +5 |
| RwLock 競合時間の閾値監視（300μs / 500μs） | +3 |
| `game_physics` の依存が 3 クレートのみ | +3 |
| SIMD パスが x86_64 専用（ARM NEON なし） | **-2** |
| WASM / `#[no_std]` への準備がゼロ | **-2** |
| スプライトアトラス UV がマジックナンバーで散在 | **-2** |
| Ghost・Skeleton の UV が `TODO` プレースホルダー | **-2** |
| ヘッドレス/オフスクリーンレンダリングモードがない | **-3** |
| ボイスリミット・優先度システムがない | **-2** |
| BGM ファイルがリポジトリに存在しない | **-2** |
| 空間オーディオが未実装 | **-1** |

**小計: +42 / -16 = +26点**

> Rust 実装は本物のプロダクション水準。SoA + SIMD + 空間ハッシュ + 決定論的物理の組み合わせは Bevy ECS と同等の思想を手書きで実現している。マイナスはすべて軽微〜中程度の未完成項目。

---

### 3. Elixir × Rust 連携の真価

| 項目 | 点数 |
|:---|:---:|
| NIF 関数の 5 カテゴリ分類（ロック競合の予測可能性） | +5 |
| 60Hz Rust ループ → `OwnedEnv::send_and_clear` → Elixir | +3 |
| パラメータ注入パターン（Rust にゲームバランス値なし） | +5 |
| `NifBridgeBehaviour` + Mox による NIF モック | +4 |
| NIF バージョニング・ABI 互換性チェックがない | **-2** |
| `set_hud_state` が毎フレーム write lock を取得 | **-1** |
| Rust → Elixir メールボックスへのバックプレッシャーがない | **-3** |

**小計: +17 / -6 = +11点**

> 連携設計は思想的に正しく、NIF カテゴリ分類とパラメータ注入パターンは特に優秀。バックプレッシャーの欠如が唯一の重大な問題。

---

### 4. 物理層

| 項目 | 点数 |
|:---|:---:|
| 7 種の `FirePattern`（正確な幾何学計算） | +4 |
| 障害物押し出し最大 5 回反復（収束保証） | +2 |
| 敵分離アルゴリズム | +2 |
| ボス速度・タイマーの Elixir 注入（SSoT 最難関） | +4 |
| ARM NEON の SIMD 実装がない | **-2** |
| 広域フェーズに BVH / AABB ツリーがない | **-2** |
| 物理ステップ実行順序が暗黙的でドキュメントがない | **-2** |

**小計: +12 / -6 = +6点**

> 現在のゲームスケールで必要な物理機能は揃っている。マイナスは将来の拡張に関わる設計上の課題。

---

### 5. 描画層

| 項目 | 点数 |
|:---|:---:|
| wgpu インスタンス描画（最大 14,502 エントリ） | +3 |
| サブフレーム補間（lerp）がロック外で計算される | +4 |
| WGSL スプライトシェーダー（レガシー GLSL なし） | +2 |
| レンダーグラフ・明示的パス依存宣言がない | **-2** |
| フラスタムカリングがない | **-2** |
| egui HUD ロジックがレンダリングバックエンドと結合 | **-2** |
| ヘッドレス/オフスクリーンレンダリングモードがない | **-3** |

**小計: +9 / -9 = 0点**

> lerp 補間の実装は特に評価できる。ヘッドレスモードの欠如が CI テストを阻害する点が大きなマイナス。

---

### 6. オーディオ層

| 項目 | 点数 |
|:---|:---:|
| コマンドパターン + `mpsc::channel` 完全非同期 | +3 |
| デバイス不在時のグレースフルフォールバック | +4 |
| 4 段階フォールバックのアセット探索 | +2 |
| 空間オーディオが未実装 | **-1** |
| ボイスリミット・優先度システムがない | **-2** |
| BGM ファイルがリポジトリに存在しない | **-2** |

**小計: +9 / -5 = +4点**

> アーキテクチャは正しく、フォールバック設計はプロダクション品質。コンテンツの充実度が低い。

---

### 7. コンポーネント層

| 項目 | 点数 |
|:---|:---:|
| Unity 相当のライフサイクルコールバック | +3 |
| シーンスタック（push / pop / replace）完全実装 | +3 |
| `pause_on_push?/1` によるシーン別ポーズ制御 | +2 |
| `on_physics_process` が実質 `on_process` と同一レート | **-1** |
| コンポーネント依存性注入・サービスロケーターがない | **-2** |

**小計: +8 / -3 = +5点**

> コンポーネント抽象化は明確で、2コンテンツで実証済み。設計の洗練度は高い。

---

### 8. ネットワーク層

| 項目 | 点数 |
|:---|:---:|
| DynamicSupervisor + Registry アーキテクチャが先行実装済み | +2 |
| 決定論的 LCG 乱数（ロックステップ同期の正しい基盤） | +2 |
| `game_network.ex` が 0% 実装 | **-5** |
| Phoenix Channels / WebSocket トランスポートがない | **-4** |
| UDP ゲーム状態同期がない | **-4** |
| ラグ補償・ロールバック netcode がない | **-2** |

**小計: +4 / -15 = -11点**

> プロジェクト最大の失点。Elixir を選んだ根拠の全てがこの層に依存しているにもかかわらず、完全に未実装。

---

### 9. ユーザー層

| 項目 | 点数 |
|:---|:---:|
| HMAC 署名付きセーブデータ | +3 |
| 上位 10 件ハイスコア管理 | +1 |
| ゲーム内設定 UI がない | **-2** |
| セーブ形式が Erlang バイナリ term（非ポータブル） | **-2** |
| 決定論的乱数があるにもかかわらずリプレイが未実装 | **-1** |

**小計: +4 / -5 = -1点**

> 基本機能は正しく動作する。HMAC 署名は評価できる。設定 UI とリプレイは明らかな欠如。

---

### 10. プロジェクト全体設計

| 項目 | 点数 |
|:---|:---:|
| 11 ファイル・約 1,500 行のドキュメント（Mermaid 図付き） | +5 |
| 自己認識的な弱点管理（improvement-plan / pending-issues） | +3 |
| Umbrella プロジェクトによるアプリ境界の明確化 | +2 |
| Rust ワークスペース + `"nif"` フィーチャーフラグ | +2 |
| `game_content` 純粋関数テストが `async: true` で並列実行可能 | +2 |
| Rust `chase_ai.rs` の充実した単体テスト | +4 |
| CI/CD パイプラインが存在しない | **-4** |
| `visual-editor-architecture.md` が存在しないシステムを記述 | **-1** |
| `improvement-plan.md` が完了済みと進行中を混在 | **-1** |
| Elixir → Rust フルラウンドトリップのベンチマークがない | **-2** |

**小計: +18 / -8 = +10点**

> ドキュメントの質は個人プロジェクトとして異例の水準。CI がないのはその品質意識と矛盾する。

---

## 総合スコア

| 観点 | プラス | マイナス | 小計 |
|:---|:---:|:---:|:---:|
| 1. Elixir の真価 | +29 | -24 | **+5** |
| 2. Rust の真価 | +42 | -16 | **+26** |
| 3. Elixir × Rust 連携 | +17 | -6 | **+11** |
| 4. 物理層 | +12 | -6 | **+6** |
| 5. 描画層 | +9 | -9 | **0** |
| 6. オーディオ層 | +9 | -5 | **+4** |
| 7. コンポーネント層 | +8 | -3 | **+5** |
| 8. ネットワーク層 | +4 | -15 | **-11** |
| 9. ユーザー層 | +4 | -5 | **-1** |
| 10. プロジェクト全体設計 | +18 | -8 | **+10** |
| **合計** | **+152** | **-97** | **+55点** |

---

## 判定

**AlchemyEngine の総合スコアは +55点。**

Rust 層は圧倒的（+26点）であり、SoA ECS・SIMD・空間ハッシュ・決定論的物理の組み合わせは Bevy ECS と同等の思想を手書きで実現している。Elixir × Rust 連携の設計思想も正しく、NIF カテゴリ分類とパラメータ注入パターンは特に優秀（+11点）。ドキュメントも個人プロジェクトとして異例の水準（+10点）。

しかし、ネットワーク層が-11点と唯一の大幅マイナスとなっており、Elixir の真価も+5点止まりである。現状のコードベースは「高性能シングルプレイヤーゲームに Elixir の薄いラッパーをかけたもの」であり、「Elixir + Rust によるスケーラブルなゲームエンジン」ではない。

### +55点 → +80点 以上にするための優先アクション

1. **`GameNetwork.Local` の実装**（推定 +20点）— ローカルマルチプレイヤーだけでも Elixir の真価を証明できる
2. **CI/CD パイプラインの追加**（推定 +6点）— `mix test` + `cargo test` の自動化
3. **`GameEvents` の分解**（推定 +5点）— 697 行を 3〜4 モジュールに分割
4. **Elixir 側コアテストの追加**（推定 +5点）— `GameEvents` / `SceneManager` / `EventBus`
5. **バックプレッシャーの実装**（推定 +3点）— Rust → Elixir メールボックスの流量制御

---

*プラス点の詳細: `docs/evaluation/specific-strengths.md`*
*マイナス点の詳細: `docs/evaluation/specific-weaknesses.md`*
*改善提案書: `docs/task/improvement-plan.md`*
